@model HLE.FamilyHealth.Models.ViewModels.ProviderIndexViewModel
@{
    ViewData["Title"] = "Healthcare Providers";
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">Healthcare Providers</h2>
            <p class="text-muted mb-0">Manage doctors, hospitals, and other healthcare providers</p>
        </div>
        @{
            ViewData["Text"] = "Add Provider";
            ViewData["Variant"] = "primary";
            ViewData["Href"] = Url.Action("Create");
            ViewData["Icon"] = "bi bi-plus";
        }
        <partial name="_Button" />
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        ViewData["AlertType"] = "success";
        ViewData["AlertMessage"] = TempData["SuccessMessage"]?.ToString();
        ViewData["AlertDismissible"] = true;
        <partial name="_Alert" />
    }

    <div class="card">
        <div class="card-body">
            @if (!Model.Providers.Any())
            {
                <div class="text-center py-5">
                    <i class="bi bi-hospital text-muted" style="font-size: 3rem;"></i>
                    <p class="text-muted mb-3 mt-3">No healthcare providers found. Add providers to maintain contact information.</p>
                    <a href="@Url.Action("Create")" class="btn btn-primary">
                        <i class="bi bi-plus"></i> Add Provider
                    </a>
                </div>
            }
            else
            {
                var providersByType = Model.Providers.GroupBy(p => p.Type).OrderBy(g => g.Key);

                @foreach (var group in providersByType)
                {
                    <div class="mb-4">
                        <h5 class="mb-3">
                            @group.Key
                            @{
                                ViewData["BadgeText"] = group.Count().ToString();
                                ViewData["BadgeVariant"] = "secondary";
                                ViewData["BadgePill"] = "True";
                            }
                            <partial name="_Badge" />
                        </h5>

                        <div class="table-responsive table-mobile-cards-wrapper">
                            <table class="table-themed table-hover table-mobile-cards">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Specialty</th>
                                        <th>Phone</th>
                                        <th>Email</th>
                                        <th>Portal</th>
                                        <th>Status</th>
                                        <th class="text-end">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var provider in group.OrderBy(p => p.Name))
                                    {
                                        <tr>
                                            <td data-label="Name" data-primary="true"><strong>@provider.Name</strong></td>
                                            <td data-label="Specialty">@(provider.Specialty ?? "-")</td>
                                            <td data-label="Phone">
                                                @if (!string.IsNullOrEmpty(provider.PhoneNumber))
                                                {
                                                    <i class="bi bi-telephone"></i>
                                                    @provider.PhoneNumber
                                                }
                                                else
                                                {
                                                    <span class="text-muted">-</span>
                                                }
                                            </td>
                                            <td data-label="Email">
                                                @if (!string.IsNullOrEmpty(provider.Email))
                                                {
                                                    <i class="bi bi-envelope"></i>
                                                    @provider.Email
                                                }
                                                else
                                                {
                                                    <span class="text-muted">-</span>
                                                }
                                            </td>
                                            <td data-label="Portal">
                                                @if (!string.IsNullOrEmpty(provider.PortalUrl))
                                                {
                                                    <a href="@provider.PortalUrl" target="_blank" class="btn btn-sm btn-outline-primary">
                                                        <i class="bi bi-box-arrow-up-right"></i> Portal
                                                    </a>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">-</span>
                                                }
                                            </td>
                                            <td data-label="Status">
                                                @if (provider.IsActive)
                                                {
                                                    ViewData["BadgeText"] = "Active";
                                                    ViewData["BadgeVariant"] = "success";
                                                    <partial name="_Badge" />
                                                }
                                                else
                                                {
                                                    ViewData["BadgeText"] = "Inactive";
                                                    ViewData["BadgeVariant"] = "secondary";
                                                    <partial name="_Badge" />
                                                }
                                            </td>
                                            <td class="text-end">
                                                <div class="btn-group btn-group-sm">
                                                    <a href="@Url.Action("Details", new { id = provider.Id })" class="btn btn-outline-primary btn-sm">View</a>
                                                    <a href="@Url.Action("Edit", new { id = provider.Id })" class="btn btn-outline-secondary btn-sm">Edit</a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
</div>
