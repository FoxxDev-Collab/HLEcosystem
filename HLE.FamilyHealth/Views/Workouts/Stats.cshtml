@model HLE.FamilyHealth.Models.ViewModels.WorkoutStatsViewModel
@{
    ViewData["Title"] = "Workout Stats";
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index")">Workouts</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Stats</li>
                </ol>
            </nav>
            <h2 class="mb-1">Workout Stats</h2>
            <p class="text-muted mb-0">Track your progress and analyze workout trends</p>
        </div>
        <div class="d-flex gap-2">
            <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Workouts
            </a>
        </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label asp-for="SelectedFamilyMemberId" class="form-label">Family Member</label>
                    <select asp-for="SelectedFamilyMemberId" asp-items="Model.FamilyMembers" class="form-select">
                        <option value="">All Family Members</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label asp-for="StartDate" class="form-label">Start Date</label>
                    <input asp-for="StartDate" type="date" class="form-control" />
                </div>
                <div class="col-md-2">
                    <label asp-for="EndDate" class="form-label">End Date</label>
                    <input asp-for="EndDate" type="date" class="form-control" />
                </div>
                <div class="col-md-3">
                    <label asp-for="SelectedExercise" class="form-label">Exercise (for Progression)</label>
                    <select asp-for="SelectedExercise" asp-items="Model.Exercises" class="form-select">
                        <option value="">Select an exercise...</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                    <a href="@Url.Action("Stats")" class="btn btn-outline-secondary">Clear</a>
                </div>
            </form>
        </div>
    </div>

    @if (!Model.HasData)
    {
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="bi bi-bar-chart-line display-1 text-muted mb-3"></i>
                <h4>No workout data found</h4>
                <p class="text-muted mb-4">Start logging workouts to see your stats and progress.</p>
                <a href="@Url.Action("Create")" class="btn btn-primary">
                    <i class="bi bi-plus"></i> Log a Workout
                </a>
            </div>
        </div>
    }
    else
    {
        <!-- Summary Stats -->
        <div class="row g-3 mb-4">
            <div class="col-md col-sm-6">
                @{
                    ViewData["CardIcon"] = "<i class=\"bi bi-activity\"></i>";
                    ViewData["CardTitle"] = "Total Workouts";
                    ViewData["CardValue"] = Model.TotalWorkouts.ToString();
                    ViewData["CardSubtitle"] = "in period";
                    ViewData["CardVariant"] = "primary";
                }
                <partial name="_StatCard" />
            </div>
            <div class="col-md col-sm-6">
                @{
                    ViewData["CardIcon"] = "<i class=\"bi bi-list-check\"></i>";
                    ViewData["CardTitle"] = "Total Exercises";
                    ViewData["CardValue"] = Model.TotalExercises.ToString();
                    ViewData["CardSubtitle"] = "performed";
                    ViewData["CardVariant"] = "info";
                }
                <partial name="_StatCard" />
            </div>
            <div class="col-md col-sm-6">
                @{
                    ViewData["CardIcon"] = "<i class=\"bi bi-123\"></i>";
                    ViewData["CardTitle"] = "Total Sets";
                    ViewData["CardValue"] = Model.TotalSets.ToString();
                    ViewData["CardSubtitle"] = "completed";
                    ViewData["CardVariant"] = "success";
                }
                <partial name="_StatCard" />
            </div>
            <div class="col-md col-sm-6">
                @{
                    ViewData["CardIcon"] = "<i class=\"bi bi-clock\"></i>";
                    ViewData["CardTitle"] = "Total Duration";
                    ViewData["CardValue"] = Model.TotalDurationFormatted;
                    ViewData["CardSubtitle"] = "of training";
                    ViewData["CardVariant"] = "warning";
                }
                <partial name="_StatCard" />
            </div>
            <div class="col-md col-sm-6">
                @{
                    ViewData["CardIcon"] = "<i class=\"bi bi-trophy\"></i>";
                    ViewData["CardTitle"] = "Total Volume";
                    ViewData["CardValue"] = Model.TotalVolume.ToString("N0");
                    ViewData["CardSubtitle"] = "lbs lifted";
                    ViewData["CardVariant"] = "danger";
                }
                <partial name="_StatCard" />
            </div>
        </div>

        <!-- Charts Row 1 -->
        <div class="row g-4 mb-4">
            <div class="col-lg-8">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">Workout Frequency (per week)</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="workoutFrequencyChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">Top Exercises</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="topExercisesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row 2 -->
        <div class="row g-4 mb-4">
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">Volume Trends (sets per workout)</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="volumeTrendsChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h6 class="mb-0">Duration Trends (minutes)</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="durationTrendsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Exercise Deep Dive Section -->
        @if (Model.HasExerciseSelected)
        {
            var stats = Model.ExerciseStats!;
            var trendClass = stats.Trend switch
            {
                "improving" => "text-success",
                "declining" => "text-danger",
                _ => "text-muted"
            };
            var trendIcon = stats.Trend switch
            {
                "improving" => "bi-arrow-up-circle-fill",
                "declining" => "bi-arrow-down-circle-fill",
                _ => "bi-dash-circle"
            };

            <div class="mt-5 mb-4">
                <h4 class="mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Exercise Analysis: @stats.ExerciseName</h4>
                <p class="text-muted">Detailed stats and progression for this exercise</p>
            </div>

            <!-- PR Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="card border-warning h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-trophy-fill text-warning me-2 fs-4"></i>
                                <h6 class="mb-0 text-muted">Weight PR</h6>
                            </div>
                            <h3 class="mb-1">@stats.WeightPRDisplay</h3>
                            @if (stats.WeightPRDate.HasValue)
                            {
                                <small class="text-muted">Set on @stats.WeightPRDate.Value.ToLocalTime().ToString("MMM d, yyyy")</small>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-info h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-lightning-fill text-info me-2 fs-4"></i>
                                <h6 class="mb-0 text-muted">Reps PR</h6>
                            </div>
                            <h3 class="mb-1">@stats.RepsPRDisplay</h3>
                            @if (stats.RepsPRDate.HasValue)
                            {
                                <small class="text-muted">Set on @stats.RepsPRDate.Value.ToLocalTime().ToString("MMM d, yyyy")</small>
                            }
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-success h-100">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-fire text-success me-2 fs-4"></i>
                                <h6 class="mb-0 text-muted">Session Volume PR</h6>
                            </div>
                            <h3 class="mb-1">@(stats.SessionVolumePR.HasValue ? $"{stats.SessionVolumePR:N0} lbs" : "-")</h3>
                            @if (stats.SessionVolumePRDate.HasValue)
                            {
                                <small class="text-muted">Set on @stats.SessionVolumePRDate.Value.ToLocalTime().ToString("MMM d, yyyy")</small>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Summary -->
            <div class="row g-3 mb-4">
                <div class="col-6 col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h6 class="text-muted mb-1">Times Performed</h6>
                            <h4 class="mb-0">@stats.TimesPerformed</h4>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h6 class="text-muted mb-1">Total Sets</h6>
                            <h4 class="mb-0">@stats.TotalSets</h4>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h6 class="text-muted mb-1">Total Reps</h6>
                            <h4 class="mb-0">@stats.TotalReps.ToString("N0")</h4>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h6 class="text-muted mb-1">Total Volume</h6>
                            <h4 class="mb-0">@stats.TotalVolume.ToString("N0") <small class="text-muted">lbs</small></h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Averages & Trend -->
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h6 class="text-muted mb-1">Average Weight</h6>
                            <h4 class="mb-0">@(stats.AverageWeight.HasValue ? $"{stats.AverageWeight:0.#} lbs" : "-")</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h6 class="text-muted mb-1">Avg Reps/Set</h6>
                            <h4 class="mb-0">@(stats.AverageRepsPerSet.HasValue ? $"{stats.AverageRepsPerSet:0.#}" : "-")</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h6 class="text-muted mb-1">Trend</h6>
                            <h4 class="mb-0 @trendClass">
                                <i class="bi @trendIcon me-1"></i>@stats.TrendDisplay
                            </h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timeline -->
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="text-muted mb-2"><i class="bi bi-calendar-event me-1"></i> First Performed</h6>
                            <p class="mb-0">@(stats.FirstPerformed?.ToLocalTime().ToString("dddd, MMMM d, yyyy") ?? "-")</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="text-muted mb-2"><i class="bi bi-calendar-check me-1"></i> Last Performed</h6>
                            <p class="mb-0">@(stats.LastPerformed?.ToLocalTime().ToString("dddd, MMMM d, yyyy") ?? "-")</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progression Chart -->
            @if (Model.ExerciseProgressionData.Any())
            {
                <div class="row g-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up me-2"></i>Weight & Rep Progression Over Time</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="exerciseProgressionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else if (!string.IsNullOrEmpty(Model.SelectedExercise))
        {
            <div class="card mt-4">
                <div class="card-body text-center py-5">
                    <i class="bi bi-search display-4 text-muted mb-3"></i>
                    <h5>No data found for "@Model.SelectedExercise"</h5>
                    <p class="text-muted mb-0">Try adjusting the date range or check the exercise name.</p>
                </div>
            </div>
        }
        else
        {
            <div class="card mt-4 border-primary">
                <div class="card-body text-center py-5">
                    <i class="bi bi-hand-index-thumb display-4 text-primary mb-3"></i>
                    <h5>Select an Exercise for Detailed Stats</h5>
                    <p class="text-muted mb-3">Use the "Exercise (for Progression)" dropdown above to see PR tracking, trends, and progression charts for a specific exercise.</p>
                    <p class="text-muted mb-0"><small>Try: Bench Press, Squat, Deadlift, or any exercise you've logged</small></p>
                </div>
            </div>
        }
    }
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        @{
            var jsonOptions = new System.Text.Json.JsonSerializerOptions
            {
                PropertyNamingPolicy = System.Text.Json.JsonNamingPolicy.CamelCase
            };
        }

        (function() {
            // Store chart instances for cleanup
            const charts = {};

            // Check if dark mode is active
            function isDarkMode() {
                return document.documentElement.classList.contains('dark') ||
                       document.body.classList.contains('dark');
            }

            // Get theme-aware colors
            function getChartColors() {
                const dark = isDarkMode();
                return {
                    chart1: 'rgb(30, 157, 241)',
                    chart2: 'rgb(0, 184, 122)',
                    chart3: 'rgb(247, 185, 40)',
                    chart4: 'rgb(23, 191, 99)',
                    chart5: 'rgb(224, 36, 94)',
                    foreground: dark ? 'rgb(231, 233, 234)' : 'rgb(15, 20, 25)',
                    muted: dark ? 'rgb(161, 161, 161)' : 'rgb(114, 118, 122)',
                    gridLine: dark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                    gridLineBorder: dark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)'
                };
            }

            // Helper to add alpha to rgb color
            function withAlpha(rgb, alpha) {
                return rgb.replace('rgb(', 'rgba(').replace(')', `, ${alpha})`);
            }

            // Destroy all existing charts
            function destroyCharts() {
                Object.keys(charts).forEach(key => {
                    if (charts[key]) {
                        charts[key].destroy();
                        delete charts[key];
                    }
                });
            }

            // Create all charts
            function createCharts() {
                const colors = getChartColors();

                // Common chart options
                const commonOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: colors.muted },
                            grid: { color: colors.gridLine },
                            border: { color: colors.gridLineBorder }
                        },
                        y: {
                            ticks: { color: colors.muted },
                            grid: { color: colors.gridLine },
                            border: { color: colors.gridLineBorder },
                            beginAtZero: true
                        }
                    }
                };

                @if (Model.HasData)
                {
                    <text>
                    // Workout Frequency Chart
                    const frequencyData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.WorkoutFrequencyData, jsonOptions));
                    const freqCtx = document.getElementById('workoutFrequencyChart');
                    if (freqCtx) {
                        charts.frequency = new Chart(freqCtx, {
                            type: 'line',
                            data: {
                                labels: frequencyData.map(d => d.label),
                                datasets: [{
                                    label: 'Workouts',
                                    data: frequencyData.map(d => d.value),
                                    borderColor: colors.chart1,
                                    backgroundColor: withAlpha(colors.chart1, 0.15),
                                    fill: true,
                                    tension: 0.3,
                                    borderWidth: 2,
                                    pointBackgroundColor: colors.chart1,
                                    pointBorderColor: colors.chart1,
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                }]
                            },
                            options: {
                                ...commonOptions,
                                plugins: {
                                    ...commonOptions.plugins,
                                    tooltip: {
                                        backgroundColor: isDarkMode() ? 'rgba(38, 38, 38, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                                        titleColor: colors.foreground,
                                        bodyColor: colors.foreground,
                                        borderColor: colors.gridLineBorder,
                                        borderWidth: 1,
                                        callbacks: {
                                            label: function(context) {
                                                return context.raw + ' workout' + (context.raw !== 1 ? 's' : '');
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }

                    // Top Exercises Chart
                    const exercisesData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.TopExercisesData, jsonOptions));
                    const exCtx = document.getElementById('topExercisesChart');
                    if (exCtx) {
                        charts.exercises = new Chart(exCtx, {
                            type: 'bar',
                            data: {
                                labels: exercisesData.map(d => d.label),
                                datasets: [{
                                    label: 'Times Performed',
                                    data: exercisesData.map(d => d.value),
                                    backgroundColor: [
                                        withAlpha(colors.chart1, 0.8),
                                        withAlpha(colors.chart2, 0.8),
                                        withAlpha(colors.chart3, 0.8),
                                        withAlpha(colors.chart4, 0.8),
                                        withAlpha(colors.chart5, 0.8),
                                        withAlpha(colors.chart1, 0.8),
                                        withAlpha(colors.chart2, 0.8),
                                        withAlpha(colors.chart3, 0.8),
                                        withAlpha(colors.chart4, 0.8),
                                        withAlpha(colors.chart5, 0.8)
                                    ],
                                    borderColor: [
                                        colors.chart1, colors.chart2, colors.chart3,
                                        colors.chart4, colors.chart5, colors.chart1,
                                        colors.chart2, colors.chart3, colors.chart4, colors.chart5
                                    ],
                                    borderWidth: 1,
                                    borderRadius: 4
                                }]
                            },
                            options: {
                                ...commonOptions,
                                indexAxis: 'y',
                                plugins: {
                                    ...commonOptions.plugins,
                                    tooltip: {
                                        backgroundColor: isDarkMode() ? 'rgba(38, 38, 38, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                                        titleColor: colors.foreground,
                                        bodyColor: colors.foreground,
                                        borderColor: colors.gridLineBorder,
                                        borderWidth: 1
                                    }
                                },
                                scales: {
                                    x: {
                                        ticks: { color: colors.muted },
                                        grid: { color: colors.gridLine },
                                        border: { color: colors.gridLineBorder },
                                        beginAtZero: true
                                    },
                                    y: {
                                        ticks: { color: colors.muted },
                                        grid: { display: false },
                                        border: { color: colors.gridLineBorder }
                                    }
                                }
                            }
                        });
                    }

                    // Volume Trends Chart
                    const volumeData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.VolumeTrendsData, jsonOptions));
                    const volCtx = document.getElementById('volumeTrendsChart');
                    if (volCtx) {
                        charts.volume = new Chart(volCtx, {
                            type: 'bar',
                            data: {
                                labels: volumeData.map(d => d.label),
                                datasets: [{
                                    label: 'Total Sets',
                                    data: volumeData.map(d => d.value),
                                    backgroundColor: withAlpha(colors.chart2, 0.7),
                                    borderColor: colors.chart2,
                                    borderWidth: 1,
                                    borderRadius: 4
                                }]
                            },
                            options: {
                                ...commonOptions,
                                plugins: {
                                    ...commonOptions.plugins,
                                    tooltip: {
                                        backgroundColor: isDarkMode() ? 'rgba(38, 38, 38, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                                        titleColor: colors.foreground,
                                        bodyColor: colors.foreground,
                                        borderColor: colors.gridLineBorder,
                                        borderWidth: 1
                                    }
                                }
                            }
                        });
                    }

                    // Duration Trends Chart
                    const durationData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.DurationTrendsData, jsonOptions));
                    const durCtx = document.getElementById('durationTrendsChart');
                    if (durCtx) {
                        charts.duration = new Chart(durCtx, {
                            type: 'line',
                            data: {
                                labels: durationData.map(d => d.label),
                                datasets: [{
                                    label: 'Duration (min)',
                                    data: durationData.map(d => d.value),
                                    borderColor: colors.chart3,
                                    backgroundColor: withAlpha(colors.chart3, 0.15),
                                    fill: true,
                                    tension: 0.3,
                                    borderWidth: 2,
                                    pointBackgroundColor: colors.chart3,
                                    pointBorderColor: colors.chart3,
                                    pointRadius: 4,
                                    pointHoverRadius: 6
                                }]
                            },
                            options: {
                                ...commonOptions,
                                plugins: {
                                    ...commonOptions.plugins,
                                    tooltip: {
                                        backgroundColor: isDarkMode() ? 'rgba(38, 38, 38, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                                        titleColor: colors.foreground,
                                        bodyColor: colors.foreground,
                                        borderColor: colors.gridLineBorder,
                                        borderWidth: 1,
                                        callbacks: {
                                            label: function(context) {
                                                return Math.round(context.raw) + ' minutes';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                    </text>

                    @if (!string.IsNullOrEmpty(Model.SelectedExercise) && Model.ExerciseProgressionData.Any())
                    {
                        <text>
                        // Exercise Progression Chart (dual Y-axis)
                        const progressionData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ExerciseProgressionData, jsonOptions));
                        const progCtx = document.getElementById('exerciseProgressionChart');
                        if (progCtx) {
                            charts.progression = new Chart(progCtx, {
                                type: 'line',
                                data: {
                                    labels: progressionData.map(d => d.date),
                                    datasets: [{
                                        label: 'Max Weight (lbs)',
                                        data: progressionData.map(d => d.maxWeight),
                                        borderColor: colors.chart1,
                                        backgroundColor: withAlpha(colors.chart1, 0.15),
                                        yAxisID: 'y',
                                        tension: 0.3,
                                        borderWidth: 2,
                                        pointBackgroundColor: colors.chart1,
                                        pointRadius: 4,
                                        pointHoverRadius: 6
                                    }, {
                                        label: 'Max Reps',
                                        data: progressionData.map(d => d.maxReps),
                                        borderColor: colors.chart5,
                                        backgroundColor: withAlpha(colors.chart5, 0.15),
                                        yAxisID: 'y1',
                                        tension: 0.3,
                                        borderWidth: 2,
                                        pointBackgroundColor: colors.chart5,
                                        pointRadius: 4,
                                        pointHoverRadius: 6
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    interaction: {
                                        mode: 'index',
                                        intersect: false
                                    },
                                    plugins: {
                                        legend: {
                                            display: true,
                                            labels: {
                                                color: colors.foreground,
                                                usePointStyle: true,
                                                padding: 20
                                            }
                                        },
                                        tooltip: {
                                            backgroundColor: isDarkMode() ? 'rgba(38, 38, 38, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                                            titleColor: colors.foreground,
                                            bodyColor: colors.foreground,
                                            borderColor: colors.gridLineBorder,
                                            borderWidth: 1
                                        }
                                    },
                                    scales: {
                                        x: {
                                            ticks: { color: colors.muted },
                                            grid: { color: colors.gridLine },
                                            border: { color: colors.gridLineBorder }
                                        },
                                        y: {
                                            type: 'linear',
                                            display: true,
                                            position: 'left',
                                            title: {
                                                display: true,
                                                text: 'Weight (lbs)',
                                                color: colors.muted
                                            },
                                            ticks: { color: colors.muted },
                                            grid: { color: colors.gridLine },
                                            border: { color: colors.gridLineBorder }
                                        },
                                        y1: {
                                            type: 'linear',
                                            display: true,
                                            position: 'right',
                                            title: {
                                                display: true,
                                                text: 'Reps',
                                                color: colors.muted
                                            },
                                            ticks: { color: colors.muted },
                                            grid: { drawOnChartArea: false },
                                            border: { color: colors.gridLineBorder }
                                        }
                                    }
                                }
                            });
                        }
                        </text>
                    }
                }
            }

            // Initialize charts on DOM ready
            document.addEventListener('DOMContentLoaded', createCharts);

            // Watch for theme changes using MutationObserver
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'class') {
                        // Theme changed, recreate charts
                        destroyCharts();
                        createCharts();
                    }
                });
            });

            // Observe both html and body for class changes
            observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
            observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
        })();
    </script>
}

<style>
    #workoutFrequencyChart,
    #topExercisesChart,
    #volumeTrendsChart,
    #durationTrendsChart,
    #exerciseProgressionChart {
        min-height: 250px;
        max-height: 300px;
    }

    #exerciseProgressionChart {
        min-height: 300px;
        max-height: 350px;
    }
</style>
