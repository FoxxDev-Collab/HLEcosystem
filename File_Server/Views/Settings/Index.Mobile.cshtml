@model HLE.FileServer.Models.UserSettingsViewModel
@{
    ViewData["Title"] = "Settings";
}

<div class="mobile-page-header">
    <h1 class="mobile-page-title">Settings</h1>
    <p class="mobile-page-subtitle">Manage your account</p>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="mobile-alert mobile-alert-success">@TempData["SuccessMessage"]</div>
}

<!-- Avatar Preview -->
<div class="mobile-card" style="text-align: center; margin-bottom: 20px;">
    <div class="avatar avatar-xl mx-auto" style="background-color: @Model.AvatarColor; color: white; font-size: 2rem; width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;" id="avatar-preview">
        @Model.Initials
    </div>
    <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0;">@Model.FirstName @Model.LastName</h3>
    <p style="font-size: 0.875rem; color: var(--muted-foreground); margin: 4px 0 0;">@Model.Email</p>
</div>

<!-- Profile Information -->
<div class="mobile-section-header">
    <h2 class="mobile-section-title">Profile Information</h2>
</div>

<div class="mobile-card">
    <div class="mobile-alert mobile-alert-info" style="margin-bottom: 16px;">
        Your profile information is managed through your organization's identity provider.
    </div>

    <div class="mobile-form-group">
        <label class="mobile-form-label">First Name</label>
        <input type="text" class="mobile-form-input" value="@Model.FirstName" readonly disabled />
    </div>

    <div class="mobile-form-group">
        <label class="mobile-form-label">Last Name</label>
        <input type="text" class="mobile-form-input" value="@Model.LastName" readonly disabled />
    </div>

    <div class="mobile-form-group">
        <label class="mobile-form-label">Email</label>
        <input type="email" class="mobile-form-input" value="@Model.Email" readonly disabled />
    </div>
</div>

<!-- Avatar Color -->
<div class="mobile-section-header" style="margin-top: 24px;">
    <h2 class="mobile-section-title">Avatar Color</h2>
</div>

<div class="mobile-card">
    <form asp-action="UpdateProfile" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />

        <div class="mobile-form-group">
            <label asp-for="AvatarColor" class="mobile-form-label">Choose a Color</label>
            <div style="display: flex; gap: 8px; align-items: center;">
                <input asp-for="AvatarColor" type="color" style="width: 48px; height: 48px; padding: 0; border: 1px solid var(--border); border-radius: var(--radius); cursor: pointer;" />
                <input asp-for="AvatarColor" type="text" class="mobile-form-input" placeholder="#1e9df1" style="flex: 1;" />
            </div>
        </div>

        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px;">
            @foreach (var color in new[] { "#1e9df1", "#10b981", "#f59e0b", "#ef4444", "#8b5cf6", "#ec4899", "#06b6d4", "#84cc16" })
            {
                <button type="button" class="color-preset" data-color="@color" style="width: 40px; height: 40px; border: 2px solid var(--border); border-radius: var(--radius); background-color: @color; cursor: pointer;"></button>
            }
        </div>

        <button type="submit" class="mobile-btn mobile-btn-primary mobile-btn-full">Save Changes</button>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const colorInputs = document.querySelectorAll('input[name="AvatarColor"]');
        const avatarPreview = document.getElementById('avatar-preview');

        colorInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                const color = e.target.value;
                colorInputs.forEach(i => i.value = color);
                avatarPreview.style.backgroundColor = color;
            });
        });

        document.querySelectorAll('.color-preset').forEach(button => {
            button.addEventListener('click', function() {
                const color = this.getAttribute('data-color');
                colorInputs.forEach(i => i.value = color);
                avatarPreview.style.backgroundColor = color;
            });
        });
    </script>
}
