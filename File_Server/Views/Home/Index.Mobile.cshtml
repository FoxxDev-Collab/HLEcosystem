@model HLE.FileServer.Models.DashboardViewModel
@using HLE.FileServer.Helpers
@{
    ViewData["Title"] = "Home";
    var isAuthenticated = User.Identity?.IsAuthenticated == true;

    var displayName = !string.IsNullOrEmpty(Model?.FirstName) && !string.IsNullOrEmpty(Model?.LastName)
        ? $"{Model.FirstName} {Model.LastName}"
        : !string.IsNullOrEmpty(Model?.FirstName)
            ? Model.FirstName
            : !string.IsNullOrEmpty(Model?.Email)
                ? Model.Email
                : "Guest";
}

@if (isAuthenticated)
{
    <!-- Welcome Section -->
    <div class="mobile-page-header">
        <h1 class="mobile-page-title">Hi, @displayName!</h1>
        <p class="mobile-page-subtitle">Your file server overview</p>
    </div>

    <!-- Quick Stats -->
    <div class="mobile-stats-grid">
        <div class="mobile-stat-card">
            <div class="mobile-stat-value">@(Model?.TotalFiles ?? 0)</div>
            <div class="mobile-stat-label">Total Files</div>
        </div>
        <div class="mobile-stat-card">
            <div class="mobile-stat-value">@FormatFileSize(Model?.TotalStorageBytes ?? 0)</div>
            <div class="mobile-stat-label">Storage Used</div>
        </div>
        <div class="mobile-stat-card">
            <div class="mobile-stat-value">@(Model?.RecentUploadsCount ?? 0)</div>
            <div class="mobile-stat-label">Last 7 Days</div>
        </div>
        <div class="mobile-stat-card">
            <div class="mobile-stat-value">@(Model?.UniqueFileTypes ?? 0)</div>
            <div class="mobile-stat-label">File Types</div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="mobile-section-header">
        <h2 class="mobile-section-title">Quick Actions</h2>
    </div>

    <div class="mobile-card" style="padding: 0;">
        <a href="/Files" class="mobile-list-item" style="text-decoration: none; padding: 16px;">
            <div class="mobile-list-icon" style="background: rgba(30, 157, 241, 0.1);">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
            </div>
            <div class="mobile-list-content">
                <div class="mobile-list-title">My Files</div>
                <div class="mobile-list-subtitle">Browse and manage files</div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--muted-foreground)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </a>
        <a href="/Groups" class="mobile-list-item" style="text-decoration: none; padding: 16px;">
            <div class="mobile-list-icon" style="background: rgba(34, 197, 94, 0.1);">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
            </div>
            <div class="mobile-list-content">
                <div class="mobile-list-title">Groups</div>
                <div class="mobile-list-subtitle">Collaborate with others</div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--muted-foreground)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </a>
        <a href="/Shares" class="mobile-list-item" style="text-decoration: none; padding: 16px;">
            <div class="mobile-list-icon" style="background: rgba(168, 85, 247, 0.1);">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="18" cy="5" r="3"></circle>
                    <circle cx="6" cy="12" r="3"></circle>
                    <circle cx="18" cy="19" r="3"></circle>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                </svg>
            </div>
            <div class="mobile-list-content">
                <div class="mobile-list-title">Shared</div>
                <div class="mobile-list-subtitle">Files shared with you</div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--muted-foreground)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </a>
        @if (User.IsInRole("Admin"))
        {
            <a href="/UserManagement" class="mobile-list-item" style="text-decoration: none; padding: 16px;">
                <div class="mobile-list-icon" style="background: rgba(245, 158, 11, 0.1);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <line x1="19" y1="8" x2="19" y2="14"></line>
                        <line x1="22" y1="11" x2="16" y2="11"></line>
                    </svg>
                </div>
                <div class="mobile-list-content">
                    <div class="mobile-list-title">User Management</div>
                    <div class="mobile-list-subtitle">Add or edit user accounts</div>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--muted-foreground)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </a>
        }
        <a href="/Settings" class="mobile-list-item" style="text-decoration: none; padding: 16px; border-bottom: none;">
            <div class="mobile-list-icon" style="background: rgba(107, 114, 128, 0.1);">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </div>
            <div class="mobile-list-content">
                <div class="mobile-list-title">Settings</div>
                <div class="mobile-list-subtitle">Manage your profile</div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--muted-foreground)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </a>
    </div>

    <!-- Recent Activity -->
    <div class="mobile-section-header" style="margin-top: 24px;">
        <h2 class="mobile-section-title">Recent Activity</h2>
        <a href="/Files" class="mobile-section-action">View All</a>
    </div>

    @if (Model?.RecentActivity?.Any() == true)
    {
        @foreach (var item in Model.RecentActivity.Take(5))
        {
            <div class="mobile-file-card">
                <div class="mobile-file-icon @(item.IsFolder ? "folder" : "file")">
                    @if (item.IsFolder)
                    {
                        <span style="font-size: 20px;">üìÅ</span>
                    }
                    else
                    {
                        <span style="font-size: 20px;">@GetFileIcon(item.ContentType)</span>
                    }
                </div>
                <div class="mobile-file-info">
                    <div class="mobile-file-name">@item.FileName</div>
                    <div class="mobile-file-meta">
                        @if (!item.IsFolder)
                        {
                            <span>@FormatFileSize(item.FileSize)</span>
                        }
                        <span>@item.UploadDate.ToLocalTime().ToString("MMM dd")</span>
                    </div>
                </div>
                @if (!item.IsFolder)
                {
                    <a href="/Files/Download/@item.Id" class="mobile-file-action-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                    </a>
                }
            </div>
        }
    }
    else
    {
        <div class="mobile-empty-state">
            <svg class="mobile-empty-icon" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            <h3 class="mobile-empty-title">No recent activity</h3>
            <p class="mobile-empty-description">Upload your first file to get started!</p>
            <a href="/Files" class="mobile-btn mobile-btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Upload Files
            </a>
        </div>
    }

    <!-- Storage Breakdown -->
    @if ((Model?.TotalStorageBytes ?? 0) > 0)
    {
        <div class="mobile-section-header" style="margin-top: 24px;">
            <h2 class="mobile-section-title">Storage Breakdown</h2>
        </div>

        <div class="mobile-card">
            @{
                var totalBytes = Model?.TotalStorageBytes ?? 0;
            }

            @if ((Model?.StorageByType?.DocumentsBytes ?? 0) > 0)
            {
                <div class="storage-item">
                    <div class="storage-item-header">
                        <span>üìÑ Documents</span>
                        <span>@FormatFileSize(Model?.StorageByType?.DocumentsBytes ?? 0)</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-primary" style="width: @(((double)(Model?.StorageByType?.DocumentsBytes ?? 0) / totalBytes * 100).ToString("0.##"))%"></div>
                    </div>
                </div>
            }

            @if ((Model?.StorageByType?.ImagesBytes ?? 0) > 0)
            {
                <div class="storage-item">
                    <div class="storage-item-header">
                        <span>üñºÔ∏è Images</span>
                        <span>@FormatFileSize(Model?.StorageByType?.ImagesBytes ?? 0)</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-success" style="width: @(((double)(Model?.StorageByType?.ImagesBytes ?? 0) / totalBytes * 100).ToString("0.##"))%"></div>
                    </div>
                </div>
            }

            @if ((Model?.StorageByType?.VideosBytes ?? 0) > 0)
            {
                <div class="storage-item">
                    <div class="storage-item-header">
                        <span>üé• Videos</span>
                        <span>@FormatFileSize(Model?.StorageByType?.VideosBytes ?? 0)</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-danger" style="width: @(((double)(Model?.StorageByType?.VideosBytes ?? 0) / totalBytes * 100).ToString("0.##"))%"></div>
                    </div>
                </div>
            }

            @if ((Model?.StorageByType?.AudioBytes ?? 0) > 0)
            {
                <div class="storage-item">
                    <div class="storage-item-header">
                        <span>üéµ Audio</span>
                        <span>@FormatFileSize(Model?.StorageByType?.AudioBytes ?? 0)</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-warning" style="width: @(((double)(Model?.StorageByType?.AudioBytes ?? 0) / totalBytes * 100).ToString("0.##"))%"></div>
                    </div>
                </div>
            }

            @if ((Model?.StorageByType?.OtherBytes ?? 0) > 0)
            {
                <div class="storage-item" style="border-bottom: none;">
                    <div class="storage-item-header">
                        <span>üì¶ Other</span>
                        <span>@FormatFileSize(Model?.StorageByType?.OtherBytes ?? 0)</span>
                    </div>
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-info" style="width: @(((double)(Model?.StorageByType?.OtherBytes ?? 0) / totalBytes * 100).ToString("0.##"))%"></div>
                    </div>
                </div>
            }
        </div>
    }
}
else
{
    <!-- Unauthenticated Landing Page -->
    <div class="mobile-landing">
        <div class="mobile-landing-hero">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <h1>File Server</h1>
            <p>Your personal cloud storage solution</p>
        </div>

        <a href="/Account/Login" class="mobile-btn mobile-btn-primary mobile-btn-full">
            Get Started
        </a>

        <div class="mobile-features">
            <div class="mobile-feature">
                <div class="mobile-feature-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </div>
                <div class="mobile-feature-text">
                    <h3>Easy Upload</h3>
                    <p>Drag & drop or tap to upload</p>
                </div>
            </div>

            <div class="mobile-feature">
                <div class="mobile-feature-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <div class="mobile-feature-text">
                    <h3>Secure</h3>
                    <p>Role-based permissions</p>
                </div>
            </div>

            <div class="mobile-feature">
                <div class="mobile-feature-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <div class="mobile-feature-text">
                    <h3>Share & Collaborate</h3>
                    <p>Create groups and share files</p>
                </div>
            </div>
        </div>
    </div>
}

@functions {
    string FormatFileSize(long bytes)
    {
        string[] sizes = { "B", "KB", "MB", "GB", "TB" };
        double len = bytes;
        int order = 0;
        while (len >= 1024 && order < sizes.Length - 1)
        {
            order++;
            len = len / 1024;
        }
        return $"{len:0.##} {sizes[order]}";
    }

    string GetFileIcon(string contentType)
    {
        if (contentType.StartsWith("image/")) return "üñºÔ∏è";
        if (contentType.StartsWith("video/")) return "üé•";
        if (contentType.StartsWith("audio/")) return "üéµ";
        if (contentType.Contains("pdf")) return "üìÑ";
        if (contentType.Contains("word") || contentType.Contains("document")) return "üìù";
        if (contentType.Contains("excel") || contentType.Contains("spreadsheet")) return "üìä";
        if (contentType.Contains("powerpoint") || contentType.Contains("presentation")) return "üìΩÔ∏è";
        if (contentType.Contains("zip") || contentType.Contains("rar") || contentType.Contains("compressed")) return "üì¶";
        if (contentType.Contains("text")) return "üìÉ";
        return "üìÅ";
    }
}

<style>
    .storage-item {
        padding: 12px 0;
        border-bottom: 1px solid var(--border);
    }

    .storage-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        font-size: 0.875rem;
    }

    .progress {
        background-color: var(--muted);
        border-radius: var(--radius-sm);
    }

    /* Landing page styles */
    .mobile-landing {
        padding: 24px 0;
    }

    .mobile-landing-hero {
        text-align: center;
        padding: 32px 0;
    }

    .mobile-landing-hero h1 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--foreground);
        margin: 16px 0 8px;
    }

    .mobile-landing-hero p {
        font-size: 1rem;
        color: var(--muted-foreground);
        margin-bottom: 24px;
    }

    .mobile-features {
        margin-top: 32px;
    }

    .mobile-feature {
        display: flex;
        align-items: flex-start;
        gap: 16px;
        padding: 16px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        margin-bottom: 12px;
    }

    .mobile-feature-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--radius);
        background: var(--accent);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        color: var(--primary);
    }

    .mobile-feature-text h3 {
        font-size: 1rem;
        font-weight: 600;
        color: var(--foreground);
        margin: 0 0 4px;
    }

    .mobile-feature-text p {
        font-size: 0.875rem;
        color: var(--muted-foreground);
        margin: 0;
    }
</style>
